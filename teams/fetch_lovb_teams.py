import requests
from bs4 import BeautifulSoup
import logging
import pandas as pd

# Set up logging
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
logger = logging.getLogger(__name__)

def fetch_lovb_teams():
    """
    Fetch LOVB (League One Volleyball) teams from their website.
    
    Returns:
        list: List of LOVB team dictionaries
    """
    logger.info("Fetching LOVB teams...")
    
    # Target URL
    url = "https://www.lovb.com/"
    
    try:
        # Fetch the page
        response = requests.get(url)
        response.raise_for_status()
        
        # Parse the HTML
        soup = BeautifulSoup(response.text, "html.parser")
        
        # Find all divs with the specific class
        divs = soup.find_all('div', attrs={'class': 'card relative w-full overflow-hidden'})
        
        svg_icons = {
        'LOVB Salt Lake': """<svg fill="currentColor" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" class="size-24 sm:size-32 lg:size-[10.25rem]"><path d="M21.9797 35.4142C24.3117 35.2671 26.8626 34.2582 29.0338 32.6545L30.2505 31.7581V31.7571C31.5512 30.8182 33.4201 29.3128 34.8568 28.6347C37.7635 27.0948 42.0723 26.5048 44.5935 28.5678C43.3555 25.2458 39.3722 24.343 35.9099 25.3148V20.7985C35.9519 16.0937 30.4417 13.3101 26.6794 16.1346L20.3178 20.8208C16.4875 23.5417 13.242 29.0919 16.0722 33.0745C17.2688 34.7706 19.6051 35.6059 21.9797 35.4142ZM27.4203 30.3281L27.3571 30.3748C25.46 31.7576 23.4508 32.5483 21.4788 32.6046C22.1177 30.7428 23.4683 29.0579 25.349 27.6592L27.4203 26.1331V30.3281ZM18.2301 27.7548C18.8796 26.063 20.2169 24.4099 21.9961 23.0994L28.3571 18.4132C29.2765 17.7361 30.4332 17.6395 31.4524 18.154C32.4716 18.6691 33.0797 19.6579 33.0797 20.799V26.4055C32.111 26.8893 31.1332 27.5743 30.25 28.2428V22.0183C30.2431 21.7336 30.0891 21.4883 29.8336 21.3593C29.5723 21.227 29.2754 21.252 29.0401 21.4256L23.6707 25.3812C21.2866 27.1564 19.5701 29.3479 18.7564 31.8245C17.9539 31.0986 17.4249 29.9936 18.2301 27.7548Z"></path><path d="M47.2575 31.8711C46.0609 30.1751 43.7246 29.3398 41.35 29.532C39.0179 29.6791 36.4671 30.688 34.2959 32.2917L33.0792 33.188V33.1891C31.7785 34.1279 29.9095 35.6334 28.4729 36.3115C25.5662 37.8514 21.2573 38.4414 18.7362 36.3784C19.9742 39.7004 23.9575 40.6031 27.4197 39.6314V44.1477C27.3778 48.8525 32.888 51.6361 36.6503 48.8116L43.0118 44.1254C46.8416 41.4044 50.0872 35.8548 47.2569 31.8716L47.2575 31.8711ZM35.9094 34.6181L35.9726 34.5713C37.8697 33.1886 39.8789 32.3979 41.8508 32.3416C41.2119 34.2033 39.8613 35.8883 37.9807 37.2869L35.9094 38.8131V34.6181ZM41.3335 41.8473L34.9725 46.5335C34.0532 47.2106 32.8965 47.3078 31.8773 46.7927C30.8581 46.2776 30.25 45.2888 30.25 44.1477V38.5412C31.2187 38.0575 32.1965 37.3724 33.0797 36.7039V42.9285C33.0866 43.2131 33.2406 43.4584 33.4961 43.5875C33.7574 43.7197 34.0543 43.6947 34.2895 43.5211L39.659 39.5655C42.0431 37.7904 43.7596 35.5988 44.5733 33.1222C45.3758 33.8481 45.9047 34.9531 45.0996 37.1919C44.45 38.8837 43.1127 40.5368 41.3335 41.8473Z"></path><path d="M41.9766 46.0713H42.9989L43.8922 48.8958L44.7856 46.0713H45.8079L44.4196 49.9451H43.3649L41.9766 46.0713Z"></path><path d="M46.0671 46.0713H47.6063C48.3865 46.0713 48.8761 46.4425 48.8761 47.0128C48.8761 47.4376 48.634 47.7445 48.2091 47.8789C48.6987 47.9814 48.9999 48.309 48.9999 48.8097C48.9999 49.4985 48.4513 49.9451 47.6116 49.9451H46.0671V46.0713ZM47.4501 47.6155C47.7247 47.6155 47.9021 47.4647 47.9021 47.2119C47.9021 46.9591 47.7353 46.8243 47.4608 46.8243H46.9817V47.615H47.4501V47.6155ZM47.4878 49.1921C47.8054 49.1921 47.9934 49.0147 47.9934 48.7455C47.9934 48.4763 47.8049 48.3154 47.5038 48.3154H46.9817V49.1921H47.4878Z"></path></svg>""",
        'LOVB Atlanta': """<svg fill="currentColor" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" class="size-24 sm:size-32 lg:size-[10.25rem]"><path d="M47.8742 36.8324V41.9988H32.9885C31.669 41.9946 30.4656 40.7392 30.5127 39.4174C30.5127 38.7565 30.7636 38.0955 31.2678 37.5896L32.023 36.8318L41.6525 27.1682H18.6565L13.9845 31.8567C12.8497 32.9955 12.8497 34.8407 13.9845 35.9795C15.1193 37.1182 16.9579 37.1182 18.0927 35.9795L26.1178 27.926C26.5833 27.4589 27.227 27.1682 27.9392 27.1682C29.3612 27.1682 30.5133 28.3244 30.5133 29.7514V41.9988H25.3651V35.9884L21.7378 39.6285C19.3157 42.0592 15.7379 42.6166 12.7835 41.3056C7.70979 39.1123 6.31098 32.1935 10.3483 28.1982L15.7605 22.7662C16.263 22.2584 16.9299 21.9976 17.5903 22H41.4666C42.9381 22 44.266 22.6095 45.2166 23.591C47.1923 25.5563 47.1667 29.0205 45.163 30.9512L39.3067 36.8282H47.8748V36.8324H47.8742Z"></path><path d="M48.8504 38.041H49.891L50.8005 40.9281L51.71 38.041H52.7506L51.3369 41.9999H50.2623L48.8486 38.041H48.8504Z"></path><path d="M54.4624 41.2289C54.7861 41.2289 54.9774 41.0483 54.9774 40.7725C54.9774 40.4968 54.7867 40.3335 54.4797 40.3335H53.9475V41.2289H54.4624ZM54.4237 39.6188C54.7026 39.6188 54.8826 39.4657 54.8826 39.2055C54.8826 38.9453 54.7134 38.8096 54.4344 38.8096H53.9475V39.617H54.4237V39.6194V39.6188ZM53.0142 38.041H54.5822C55.3761 38.041 55.8756 38.4196 55.8756 39.0034C55.8756 39.4382 55.6288 39.7504 55.1955 39.888C55.6932 39.9932 56.0001 40.327 56.0001 40.8395C56.0001 41.5435 55.4405 41.9999 54.5864 41.9999H53.0142V38.041Z"></path></svg>""",
        'LOVB Austin': """<svg fill="currentColor" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" class="size-24 sm:size-32 lg:size-[10.25rem]"><path d="M42.0187 42.0381H43.0557L43.9619 44.921L44.8682 42.0381H45.9058L44.497 45.9912H43.4269L42.0181 42.0381H42.0187Z"></path><path d="M46.1685 42.0381H47.7297C48.5214 42.0381 49.0179 42.4168 49.0179 42.9986C49.0179 43.4325 48.772 43.7452 48.3413 43.8828C48.8377 43.987 49.1439 44.3222 49.1439 44.8324C49.1439 45.5354 48.5871 45.9912 47.7351 45.9912H46.1685V42.0381ZM47.5718 43.6137C47.8502 43.6137 48.0304 43.4598 48.0304 43.2023C48.0304 42.9448 47.8611 42.8065 47.5827 42.8065H47.097V43.6137H47.5718ZM47.6098 45.2228C47.9315 45.2228 48.1232 45.0416 48.1232 44.767C48.1232 44.4925 47.9322 44.3276 47.6267 44.3276H47.097V45.2228H47.6105H47.6098Z"></path><path d="M52.9952 29.6464C53.0806 28.3426 52.0131 27.252 50.714 27.252H42.3587C42.3526 27.252 42.3493 27.2438 42.3547 27.2397L49.352 21.4746C49.352 21.4746 49.3554 21.4678 49.3526 21.465L46.531 18.0017C46.531 18.0017 46.5242 17.9983 46.5215 18.0011L35.2951 27.2506C35.2951 27.2506 35.2924 27.252 35.291 27.252H22.9396C19.3411 27.252 16.157 29.5967 15.07 33.0464L11 45.9608L11.023 45.9928H18.4247C19.1792 45.9928 19.9107 45.7299 20.4945 45.249L33.1717 34.8039C33.1758 34.8005 33.1812 34.8025 33.1826 34.8073L36.7086 45.9942C36.7086 45.9942 36.712 45.999 36.7154 45.999H41.3848C41.3895 45.999 41.3929 45.9942 41.3915 45.9901L36.9037 31.7514C36.9023 31.7473 36.9057 31.7425 36.9105 31.7425H50.7675C51.9508 31.7425 52.9187 30.8167 52.9952 29.6464ZM16.7876 42.4982C16.7822 42.5023 16.7747 42.4975 16.7768 42.4907L19.3255 34.4027C19.8274 32.8113 21.2795 31.7418 22.9396 31.7418H29.8238C29.8299 31.7418 29.8333 31.75 29.8278 31.7541L16.7876 42.4982Z"></path></svg>""",
        'LOVB Houston': """<svg fill="currentColor" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" class="size-24 sm:size-32 lg:size-[10.25rem]"><path d="M39.0185 40.9062H40.05L40.9522 43.7621L41.8543 40.9062H42.8859L41.484 44.8228H40.4181L39.0161 40.9062H39.0185Z"></path><path d="M44.583 44.0602C44.9043 44.0602 45.0938 43.8815 45.0938 43.6091C45.0938 43.3367 44.9043 43.1744 44.6002 43.1744H44.0723V44.0602H44.583ZM44.5448 42.4672C44.8216 42.4672 45.0025 42.3158 45.0025 42.0583C45.0025 41.8007 44.8341 41.6665 44.5581 41.6665H44.0754V42.4649H44.548L44.5456 42.4672H44.5448ZM43.1468 40.9062H44.7016C45.4883 40.9062 45.9842 41.2809 45.9842 41.8585C45.9842 42.2885 45.7394 42.5976 45.3098 42.7334C45.8033 42.838 46.1074 43.1681 46.1074 43.6747C46.1074 44.3709 45.5523 44.8228 44.7055 44.8228H43.146V40.907L43.1468 40.9062Z"></path><path d="M50 20L37.6311 26.1901L25.2629 20V26.1901L31.447 29.2855L25.2629 32.3802V32.3888L13 26.2517V32.4418L25.3682 38.6319L37.7371 44.8228V38.6319L31.553 35.5373L37.7371 32.4418V32.4332L50 38.571V32.3802L43.8151 29.2855L50 26.1901V20Z"></path></svg>""",
        'LOVB Omaha': """<svg fill="currentColor" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" class="size-24 sm:size-32 lg:size-[10.25rem]"><path d="M56.9289 35.749H57.958L58.8576 38.6062L59.7572 35.749H60.7863L59.3876 39.6671H58.3251L56.9272 35.749H56.9289Z"></path><path d="M62.4765 38.9037C62.7965 38.9037 62.9854 38.7246 62.9854 38.4522C62.9854 38.1799 62.7965 38.0179 62.4928 38.0179H61.9669V38.9037H62.4757H62.4765ZM62.4382 37.3104C62.7142 37.3104 62.8942 37.159 62.8942 36.9014C62.8942 36.6437 62.7265 36.5096 62.4505 36.5096H61.9685V37.3087H62.4391L62.4366 37.3112L62.4382 37.3104ZM61.0469 35.7489H62.5978C63.3827 35.7489 63.8769 36.1235 63.8769 36.701C63.8769 37.1312 63.6326 37.4404 63.2044 37.5762C63.6969 37.6809 63.9998 38.0105 63.9998 38.5177C63.9998 39.2146 63.4462 39.6661 62.6019 39.6661H61.0469V35.748V35.7489Z"></path><path d="M34.8212 33.3547C34.6681 33.4741 34.4565 33.4741 34.3034 33.3547L32.6401 32.055L27.9816 28.4158L23.0641 24.5747C22.0863 23.8123 20.7177 23.8123 19.7399 24.5747L15.4355 27.9365L20.239 31.6885L21.1427 30.9834C21.2958 30.864 21.5075 30.864 21.6605 30.9834L23.1797 32.1703L27.9832 35.9223L32.9006 39.7659C33.8784 40.5282 35.247 40.5282 36.2248 39.7659L40.5276 36.4041L35.7265 32.6504L34.8228 33.3555L34.8212 33.3547Z"></path><path d="M21.6612 33.3542C21.5081 33.4737 21.2965 33.4737 21.1434 33.3542L19.6242 32.1674L14.8207 28.4154L12.0307 26.238C10.7687 25.2556 9.18602 24.6699 7.46736 24.6699C3.35022 24.6707 0 28.035 0 32.1698C0 36.3046 3.35022 39.6689 7.46817 39.6689C9.11682 39.6689 10.6401 39.1299 11.8768 38.2178L11.902 38.199C11.9891 38.1328 12.0762 38.0673 12.1609 37.9986L14.2061 36.4028L9.40747 32.6508L8.4248 33.418H8.42235C8.15694 33.6225 7.8264 33.746 7.46736 33.746C6.60192 33.746 5.89931 33.0385 5.89931 32.1715C5.89931 31.3044 6.60355 30.5969 7.46736 30.5969C7.83454 30.5969 8.16997 30.7269 8.43701 30.9396H8.43945L9.15671 31.4975L10.0075 32.1625L14.8191 35.9226L19.739 39.7679C20.7168 40.5302 22.0854 40.5302 23.0632 39.7679L27.3659 36.4061L22.5649 32.6524L21.6612 33.36V33.3534V33.3542Z"></path><path d="M48.4985 24.6707C46.7253 24.6707 45.0954 25.2989 43.8139 26.341V26.3369L41.7606 27.9393L42.1449 28.2395L46.5616 31.6905L47.5565 30.9126C47.8195 30.7147 48.146 30.5928 48.5009 30.5928C49.3664 30.5928 50.069 31.3003 50.069 32.1674V33.3199C50.069 33.5546 49.8801 33.7419 49.6489 33.7419H48.5009C48.1484 33.7419 47.8219 33.625 47.559 33.4246L41.7777 28.9078L41.1476 28.4154L36.2277 24.5718C35.2499 23.8094 33.8813 23.8094 32.9035 24.5718L28.5991 27.9336L33.4026 31.6856L34.3063 30.978C34.4594 30.8586 34.671 30.8586 34.8241 30.978L36.3433 32.1649L41.1468 35.9169L43.9938 38.1393C45.2476 39.0939 46.8092 39.6648 48.5018 39.6648H55.0654C55.5637 39.6648 55.9667 39.2599 55.9667 38.7593V32.1674C55.9667 28.0326 52.6165 24.6683 48.4985 24.6683V24.6707Z"></path></svg>""",
        'LOVB Madison': """<svg fill="currentColor" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" class="size-24 sm:size-32 lg:size-[10.25rem]"><path d="M45.9758 37.243C44.5331 38.6659 42.6179 39.4512 40.5796 39.4512H38.8347V31.9098C38.8347 29.2621 37.7917 26.7745 35.8979 24.9035C35.71 24.7178 35.5158 24.5409 35.3129 24.3702H40.5815C44.7901 24.3702 48.2145 27.7535 48.2145 31.9116C48.2145 33.9255 47.4197 35.8202 45.9795 37.2449L45.9751 37.243H45.9758ZM30.5495 39.4512H27.0578V31.9098C27.0578 29.5545 26.2309 27.3227 24.7128 25.5416C25.9262 24.7799 27.3431 24.3683 28.8027 24.3683C29.3946 24.3683 29.9796 24.4348 30.5476 24.567V39.4518H30.5495V39.4512ZM18.7744 31.9098V39.4512H9.39711V31.9098C9.39711 27.7517 12.8215 24.3683 17.0302 24.3683C18.4898 24.3683 19.9061 24.7799 21.1219 25.5416C19.6189 27.3146 18.7769 29.5694 18.7769 31.9098H18.775H18.7744ZM40.5796 22H28.8046C26.6776 22 24.6217 22.6636 22.9183 23.886C21.2149 22.6636 19.159 22 17.0302 22C11.5002 22 7 26.4461 7 31.9098V41.8196H21.1715V31.9098C21.1715 30.1498 21.798 28.4538 22.9183 27.1116C24.0474 28.46 24.6632 30.1386 24.6632 31.9098V41.8196H32.9485V25.5758C33.3996 25.8638 33.8231 26.2009 34.2032 26.5765C35.6459 28.0019 36.4382 29.8941 36.4382 31.9098V41.8196H40.5796C43.2595 41.8196 45.7772 40.789 47.671 38.918C49.5648 37.0469 50.6079 34.5575 50.6079 31.9116C50.6073 26.448 46.1071 22.0019 40.5771 22.0019L40.579 22H40.5796Z"></path><path d="M49.7997 37.8936H50.8472L51.7627 40.7542L52.6781 37.8936H53.7256L52.3024 41.817H51.2204L49.7979 37.8936H49.7997Z"></path><path d="M55.4494 41.0531C55.7755 41.0531 55.9678 40.8736 55.9678 40.6005C55.9678 40.3273 55.7755 40.1653 55.467 40.1653H54.9316V41.0531H55.45H55.4494ZM55.4104 39.457C55.6913 39.457 55.8748 39.3055 55.8748 39.0473C55.8748 38.789 55.7045 38.6549 55.4236 38.6549H54.9335V39.4551H55.4129L55.411 39.457H55.4104ZM53.9941 37.8932H55.5725C56.3718 37.8932 56.8744 38.2688 56.8744 38.8467C56.8744 39.2776 56.6262 39.5867 56.1902 39.7233C56.691 39.8276 57.0001 40.1585 57.0001 40.6663C57.0001 41.3641 56.4365 41.816 55.5769 41.816H53.9941V37.8926V37.8932Z"></path></svg>
        """
        }
        
        # Collect team data
        teams = []
        for card in divs:
            a_tag = card.find('a')
            if a_tag:
                link = a_tag.get('href', 'No href found')
                
                # Extract and format team name
                team_name = "LOVB " + " ".join(link.split('teams')[1].split('lovb')[1].split("-")[:-1]).title().strip()
                full_url = "https://www.lovb.com" + link
                team_id = link.split('/')[-1]
                
                # Get SVG icon URL or fallback to None
                img_url = svg_icons.get(team_name, None)
                
                # Append team info
                teams.append({
                    'team_id': team_id,
                    'name': team_name,
                    'name_short': link.split('teams')[1].split('lovb')[1].split("-")[:-1][1],
                    'img': img_url,
                    #'roster': full_url + "/roster",
                    #'schedule': full_url + "/schedule",
                    'url': full_url,
                    'division': 'Pro Women',
                    'conference': 'LOVB',
                    'level': 'Pro',
                    'conference_short': 'pro'
                })
        
            # Change some stuff
            team_colors = {
            "LOVB Atlanta": "#ff50b9",
            "LOVB Austin": "#fff500",
            "LOVB Houston": "#5b9af9",
            "LOVB Madison": "#4de7fd",
            "LOVB Omaha": "#9e8aff",
            "LOVB Salt Lake": "#33f08a"
            }
            
            lovb_df = pd.json_normalize(teams)
            
            # Loop through each team and apply the color change
            for team, color in team_colors.items():
                # For each team, update the 'img' column where the 'name' matches
                lovb_df.loc[lovb_df['name'] == team, 'img'] = lovb_df.loc[lovb_df['name'] == team, 'img'].str.replace(
                    'fill="currentColor"', f'fill="{color}"'
                )
                
            lovb_teams = lovb_df.to_dict('records')
        
        logger.info(f"Found {len(lovb_teams)} LOVB teams")
        return lovb_teams
    
    except requests.RequestException as e:
        logger.error(f"Error fetching LOVB teams: {e}")
        return []

